{% from "file-upload/macro.njk" import govukFileUpload %}
{% from "button/macro.njk" import govukButton %}
{% from "error-summary/macro.njk" import govukErrorSummary %}
{% from "../../component/menu/macro.njk" import menu %}
{% from "table/macro.njk" import govukTable %}


{% extends "../../component/Page.njk" %}

{% block pageTitle %}
{{ i18n.skills.title }} - {{ i18n['proposition_name'] }}
{% endblock %}

{% set banner = true %}
{% set backButton = "/content-management" %}

<!--{% set uploadedFileNotCSV = sessionFlash.uploadedFileNotCSV %}-->

{% block content %}

{% if not professionID %}
{{ govukErrorSummary({
    titleText: "There is a problem",
    errorList: [
        {
            text: "Profession is not set, Please set your profession in your profile page.",
            href: lpgUiUrl + "/profile"
        }
    ],
    classes: "custom-error-message"
}) }}
{% endif %}

{% if professionID %}

<div class="govuk-grid-row quiz">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-m govuk-!-font-size-36">Manage quiz</h1>
            <div>
                <div class="data-table">
                    {{ govukTable({
                    caption: "Data table",
                    head: [
                    {
                        text: "Profession"
                    },
                    {
                        text: "Times completed",
                        format: "numeric"
                    },
                    {
                        text: "Average score",
                        format: "numeric"
                    }
                    ],
                    rows: [
                        [
                        {
                            text: professionName
                        },
                        {
                            text: "0",
                            format: "numeric"
                        },
                        {
                            text: "0",
                            format: "numeric"
                        }
                        ]
                    ]
                    }) }}

                </div>

                <table class="govuk-table quiz-questions">
                    <caption class="govuk-table__caption">Quiz questions</caption>
                    <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Number</th>
                        <th scope="col" class="govuk-table__header">Question</th>
                        <th scope="col" class="govuk-table__header govuk-table__cell--numeric"><span class="empty-header">Manage</span></th>
                    </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                    {% if quiz.questions[0] %}
                        {% for question in quiz.questions %}
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell question-number">
                                {{loop.index}}
                            </td>
                            <td class="govuk-table__cell ">
                                {{question.value}}
                            </td>
                            <td class="govuk-table__cell govuk-table__cell--numeric">
                                <a href="/content-management/skills/{{question.id}}/edit-question">manage</a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell question-number">

                        </td>
                        <td class="govuk-table__cell question-number">
                            No questions have been added yet.
                        </td>
                        <td class="govuk-table__cell question-number">
                        </td>
                    </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>


            <p class="govuk-body">Note, once this quiz has been saved it will be published and therefore it will be available for public viewing.</p>
            <div class="button-container">
                {{ govukButton({
                    text: "Preview and save"
                }) }}
            </div>
            <a class="cancel-button govuk-body govuk-link" href="/content-management">Cancel</a>
    </div>
    <div class="govuk-grid-column-one-third">
            <div class="right-menu">
                {% block menu %}
                    {% set actions = [] %}
                    {% set action = actions.push({
                        link: '/content-management/skills/add-new-question',
                        text: 'Add a new question'
                    }) %}
                    {% set action = actions.push({
                        link: '/content-management/skills/generate-report',
                        text: 'Generate quiz report'
                    }) %}
                    {% set action = actions.push({
                        link: '/content-management/skills/edit-quiz-description',
                        text: 'Edit quiz description'
                    }) %}
                    {% set action = actions.push({
                        link: '/content-management/skills/delete-quiz',
                        text: 'Delete quiz'
                    }) %}
                    {{ menu("Actions", actions) }}
                {% endblock %}
            </div>
        </div>
    </div>

{% endif %}


{% endblock %}

{% block bodyEnd %}
<script src="/govuk-frontend/all.js"></script>
<script>window.GOVUKFrontend.initAll()</script>
<script type="text/javascript" src="/js/accessible-autocomplete.min.js"></script>
<script type="text/javascript" src="/js/manage-orgs.js"></script>
<script src="/js/file-uploader.js"></script>
{% endblock %}